# Copyright (c) Microsoft Corporation.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

# This template defines the build/test matrix: based on the given flags, it determines which
# builders should run and creates a job for each.

parameters:
  innerloop: false
  outerloop: false
  sign: false

jobs:
  - template: builders-to-jobs.yml
    parameters:
      sign: ${{ parameters.sign }}
      builders:
        - ${{ if eq(parameters.innerloop, true) }}:
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false }
        - ${{ if eq(parameters.outerloop, true) }}:
          # Upstream builders.
          - { os: linux, arch: amd64, config: clang }
          - { os: linux, arch: amd64, config: longtest }
          - { os: linux, arch: amd64, config: nocgo }
          - { os: linux, arch: amd64, config: noopt }
          - { os: linux, arch: amd64, config: race }
          # - { os: linux, arch: amd64, config: racecompile } https://github.com/microsoft/go/issues/54
          - { os: linux, arch: amd64, config: regabi }
          - { os: linux, arch: amd64, config: ssacheck }
          - { os: linux, arch: amd64, config: staticlockranking }
