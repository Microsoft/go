# Copyright (c) Microsoft Corporation.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

# This template defines the build/test matrix: based on the given flags, it determines which
# builders should run and creates a job for each.

parameters:
  innerloop: false
  outerloop: false
  sign: false

jobs:
  - template: builders-to-jobs.yml
    parameters:
      sign: ${{ parameters.sign }}
      builders:
        - ${{ if eq(parameters.innerloop, true) }}:
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 1 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 2 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 3 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 4 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 5 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 6 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 7 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 8 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 9 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: true, name: 10 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 11 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 12 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 13 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 14 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 15 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 16 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 17 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 18 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 19 }
          - { os: windows, arch: amd64, config: buildandpack, gotmp: false, name: 20 }
        - ${{ if eq(parameters.outerloop, true) }}:
          # Upstream builders.
          - { os: linux, arch: amd64, config: clang }
          - { os: linux, arch: amd64, config: longtest }
          - { os: linux, arch: amd64, config: nocgo }
          - { os: linux, arch: amd64, config: noopt }
          - { os: linux, arch: amd64, config: race }
          # - { os: linux, arch: amd64, config: racecompile } https://github.com/microsoft/go/issues/54
          - { os: linux, arch: amd64, config: regabi }
          - { os: linux, arch: amd64, config: ssacheck }
          - { os: linux, arch: amd64, config: staticlockranking }
