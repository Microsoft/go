From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: qmuntal <qmuntaldiaz@microsoft.com>
Date: Thu, 8 Jun 2023 14:17:13 +0200
Subject: [PATCH] Update default go.env

---
 go.env                                     | 6 ++++--
 src/cmd/go/testdata/script/env_changed.txt | 3 +++
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/go.env b/go.env
index 6ff2b921d464bc..4aca2ff2c63dbc 100644
--- a/go.env
+++ b/go.env
@@ -7,6 +7,8 @@
 GOPROXY=https://proxy.golang.org,direct
 GOSUMDB=sum.golang.org
 
-# Automatically download newer toolchains as directed by go.mod files.
+# Use the locally installed Go toolchain, never downloading a different one.
+# Upstream uses `GOTOOLCHAIN=auto` instead, but `auto` can download and switch
+# to a non-MSFT Go toolchain, and we want to avoid that.
 # See https://go.dev/doc/toolchain for details.
-GOTOOLCHAIN=auto
+GOTOOLCHAIN=local
diff --git a/src/cmd/go/testdata/script/env_changed.txt b/src/cmd/go/testdata/script/env_changed.txt
index a3d368cd39e480..2253bb202d8397 100644
--- a/src/cmd/go/testdata/script/env_changed.txt
+++ b/src/cmd/go/testdata/script/env_changed.txt
@@ -1,5 +1,8 @@
 # Test query for non-defaults in the env
 
+# See https://github.com/golang/go/issues/67793
+skip 'test relies on the standard go.env file, but Microsoft Go has a modified go.env file'
+
 env GOTOOLCHAIN=local
 env GOSUMDB=nodefault
 env GOPROXY=nodefault
