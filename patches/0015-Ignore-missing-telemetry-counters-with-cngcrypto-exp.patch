From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Davis Goodin <dagood@microsoft.com>
Date: Wed, 24 Jul 2024 17:52:52 -0700
Subject: [PATCH] Ignore missing telemetry counters with cngcrypto experiment

Unblocks TestScript tests until the issue is resolved upstream by allowing
the test to pass as if telemetry is disabled.
Upstream issue: https://github.com/golang/go/issues/68579.
---
 src/cmd/go/script_test.go | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/cmd/go/script_test.go b/src/cmd/go/script_test.go
index a38dec3610561e..b1dae3b592e99d 100644
--- a/src/cmd/go/script_test.go
+++ b/src/cmd/go/script_test.go
@@ -15,6 +15,7 @@ import (
 	"context"
 	_ "embed"
 	"flag"
+	"internal/goexperiment"
 	"internal/testenv"
 	"internal/txtar"
 	"net/url"
@@ -417,4 +418,6 @@ const disabledOnPlatform = false ||
 	// These platforms fundamentally can't be supported:
 	runtime.GOOS == "js" || // #60971
 	runtime.GOOS == "wasip1" || // #60971
-	runtime.GOOS == "plan9" // https://github.com/golang/go/issues/57540#issuecomment-1470766639
+	runtime.GOOS == "plan9" || // https://github.com/golang/go/issues/57540#issuecomment-1470766639
+	// On Windows, setting a GOEXPERIMENT prevents the telemetry counters from being written. https://github.com/golang/go/issues/68579
+	goexperiment.CNGCrypto
